{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\S556370\\\\Desktop\\\\Final Project\\\\project\\\\src\\\\components\\\\Chat\\\\Chat.js\",\n  _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nimport fb from \"../../utils/firebase\";\nimport useAppContext from \"../../hooks/useAppContextHook\";\nimport styled from \"styled-components\";\nimport ChatUsers from \"./ChatUsers\";\nimport ChatBox from \"./ChatBox\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  app,\n  firebase\n} = fb;\nconst ChatContainer = styled.div`\n  position: fixed;\n  bottom: 0px;\n  right: 0px;\n  display: flex;\n  align-items: flex-end;\n  justify-content: flex-end;\n`;\n_c = ChatContainer;\nexport default function Chat() {\n  _s();\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n  const [chatBoxList, setChatBoxList] = useState([]);\n  const [users, setUsers] = useState([]);\n  const [firebaseLoaded, setFirebaseLoaded] = useState(false);\n  const {\n    appState: {\n      user: {\n        username\n      }\n    }\n  } = useAppContext();\n  useEffect(() => {\n    const unsubscribe = firebase.auth().onAuthStateChanged(user => {\n      setFirebaseLoaded(true);\n    });\n    return () => unsubscribe();\n  }, []);\n  useEffect(() => {\n    if (firebaseLoaded) {\n      if (username) {\n        app.collection(\"users\").where(\"username\", \"==\", username).onSnapshot(snapshot => {\n          try {\n            setUsers((snapshot.docs || []).map(doc => doc.data()));\n          } catch (error) {}\n        });\n        return () => {\n          app.collection(`users`).onSnapshot(() => {\n            setUsers([]);\n          });\n        };\n      }\n    }\n  }, [firebaseLoaded]);\n  const handleSendMessage = async data => {\n    try {\n      const msgRef = app.collection(\"chats\");\n      await msgRef.add({\n        username,\n        recipient: data.recipient,\n        timestamp: new Date().getTime(),\n        value: data === null || data === void 0 ? void 0 : data.value\n      });\n      const userRef = app.collection(\"users\");\n      const userData = await userRef.where(\"username\", \"==\", data === null || data === void 0 ? void 0 : data.recipient).where(\"recipient\", \"==\", username).get();\n      userData.forEach(doc => {\n        userRef.doc(doc.id).update({\n          unread: true\n        });\n        return;\n      });\n      const userDataRecipient = await userRef.where(\"username\", \"==\", username).where(\"recipient\", \"==\", data === null || data === void 0 ? void 0 : data.recipient).get();\n      userDataRecipient.forEach(doc => {\n        userRef.doc(doc.id).update({\n          unread: false\n        });\n        return;\n      });\n    } catch (error) {}\n  };\n  const handleStartChat = async e => {\n    try {\n      const userRef = app.collection(\"users\");\n      await userRef.doc().set({\n        username,\n        recipient: e,\n        unread: false\n      });\n      await userRef.doc().set({\n        username: e,\n        recipient: username,\n        unread: false\n      });\n      setChatBoxList(prevState => {\n        prevState.push({\n          username,\n          recipient: e,\n          unread: false\n        });\n        return [...prevState];\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  };\n  const handleUserChatClick = async data => {\n    try {\n      const userRef = app.collection(\"users\");\n      const userData = await userRef.where(\"username\", \"==\", username).where(\"recipient\", \"==\", data === null || data === void 0 ? void 0 : data.recipient).get();\n      userData.forEach(doc => {\n        userRef.doc(doc.id).update({\n          unread: false\n        });\n        return;\n      });\n      setChatBoxList(prevState => {\n        const chatDataList = prevState.filter(item => (item === null || item === void 0 ? void 0 : item.recipient) !== (data === null || data === void 0 ? void 0 : data.recipient));\n        chatDataList.push(data);\n        return [...chatDataList];\n      });\n    } catch (error) {}\n  };\n  const handleRemoveChat = data => {\n    setChatBoxList(prevState => {\n      const chatDataList = prevState.filter(item => (item === null || item === void 0 ? void 0 : item.recipient) !== (data === null || data === void 0 ? void 0 : data.recipient));\n      return [...chatDataList];\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(ChatContainer, {\n    children: [chatBoxList.map((item, index) => /*#__PURE__*/_jsxDEV(ChatBox, {\n      data: item,\n      chatData: [],\n      onSendMessage: handleSendMessage,\n      onChatRemove: handleRemoveChat\n    }, index, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 9\n    }, this)), /*#__PURE__*/_jsxDEV(ChatUsers, {\n      users: users,\n      onStartChat: handleStartChat,\n      onClickUser: handleUserChatClick\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 134,\n    columnNumber: 5\n  }, this);\n}\n_s(Chat, \"jyFopxiULsS2VjEMUBE65towQQs=\", false, function () {\n  return [useAppContext];\n});\n_c2 = Chat;\nvar _c, _c2;\n$RefreshReg$(_c, \"ChatContainer\");\n$RefreshReg$(_c2, \"Chat\");","map":{"version":3,"names":["useEffect","useState","fb","useAppContext","styled","ChatUsers","ChatBox","jsxDEV","_jsxDEV","app","firebase","ChatContainer","div","_c","Chat","_s","message","setMessage","messages","setMessages","chatBoxList","setChatBoxList","users","setUsers","firebaseLoaded","setFirebaseLoaded","appState","user","username","unsubscribe","auth","onAuthStateChanged","collection","where","onSnapshot","snapshot","docs","map","doc","data","error","handleSendMessage","msgRef","add","recipient","timestamp","Date","getTime","value","userRef","userData","get","forEach","id","update","unread","userDataRecipient","handleStartChat","e","set","prevState","push","console","handleUserChatClick","chatDataList","filter","item","handleRemoveChat","children","index","chatData","onSendMessage","onChatRemove","fileName","_jsxFileName","lineNumber","columnNumber","onStartChat","onClickUser","_c2","$RefreshReg$"],"sources":["C:/Users/S556370/Desktop/Final Project/project/src/components/Chat/Chat.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport fb from \"../../utils/firebase\";\r\nimport useAppContext from \"../../hooks/useAppContextHook\";\r\nimport styled from \"styled-components\";\r\nimport ChatUsers from \"./ChatUsers\";\r\nimport ChatBox from \"./ChatBox\";\r\n\r\nconst { app, firebase } = fb;\r\n\r\nconst ChatContainer = styled.div`\r\n  position: fixed;\r\n  bottom: 0px;\r\n  right: 0px;\r\n  display: flex;\r\n  align-items: flex-end;\r\n  justify-content: flex-end;\r\n`;\r\n\r\nexport default function Chat() {\r\n  const [message, setMessage] = useState(\"\");\r\n  const [messages, setMessages] = useState([]);\r\n  const [chatBoxList, setChatBoxList] = useState([]);\r\n  const [users, setUsers] = useState([]);\r\n  const [firebaseLoaded, setFirebaseLoaded] = useState(false);\r\n\r\n  const {\r\n    appState: {\r\n      user: { username },\r\n    },\r\n  } = useAppContext();\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = firebase.auth().onAuthStateChanged((user) => {\r\n      setFirebaseLoaded(true);\r\n    });\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (firebaseLoaded) {\r\n      if (username) {\r\n        app\r\n          .collection(\"users\")\r\n          .where(\"username\", \"==\", username)\r\n          .onSnapshot((snapshot) => {\r\n            try {\r\n              setUsers((snapshot.docs || []).map((doc) => doc.data()));\r\n            } catch (error) {}\r\n          });\r\n        return () => {\r\n          app.collection(`users`).onSnapshot(() => {\r\n            setUsers([]);\r\n          });\r\n        };\r\n      }\r\n    }\r\n  }, [firebaseLoaded]);\r\n\r\n  const handleSendMessage = async (data) => {\r\n    try {\r\n      const msgRef = app.collection(\"chats\");\r\n      await msgRef.add({\r\n        username,\r\n        recipient: data.recipient,\r\n        timestamp: new Date().getTime(),\r\n        value: data?.value,\r\n      });\r\n      const userRef = app.collection(\"users\");\r\n      const userData = await userRef.where(\"username\", \"==\", data?.recipient).where(\"recipient\", \"==\", username).get();\r\n      userData.forEach((doc) => {\r\n        userRef.doc(doc.id).update({\r\n          unread: true,\r\n        });\r\n        return;\r\n      });\r\n      const userDataRecipient = await userRef.where(\"username\", \"==\", username).where(\"recipient\", \"==\", data?.recipient).get();\r\n      userDataRecipient.forEach((doc) => {\r\n        userRef.doc(doc.id).update({\r\n          unread: false,\r\n        });\r\n        return;\r\n      });\r\n    } catch (error) {}\r\n  };\r\n\r\n  const handleStartChat = async (e) => {\r\n    try {\r\n      const userRef = app.collection(\"users\");\r\n      await userRef.doc().set({\r\n        username,\r\n        recipient: e,\r\n        unread: false,\r\n      });\r\n      await userRef.doc().set({\r\n        username: e,\r\n        recipient: username,\r\n        unread: false,\r\n      });\r\n      setChatBoxList((prevState) => {\r\n        prevState.push({ username, recipient: e, unread: false });\r\n        return [...prevState];\r\n      });\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleUserChatClick = async (data) => {\r\n    try {\r\n      const userRef = app.collection(\"users\");\r\n      const userData = await userRef.where(\"username\", \"==\", username).where(\"recipient\", \"==\", data?.recipient).get();\r\n      userData.forEach((doc) => {\r\n        userRef.doc(doc.id).update({\r\n          unread: false,\r\n        });\r\n        return;\r\n      });\r\n      setChatBoxList((prevState) => {\r\n        const chatDataList = prevState.filter((item) => item?.recipient !== data?.recipient);\r\n        chatDataList.push(data);\r\n        return [...chatDataList];\r\n      });\r\n    } catch (error) {}\r\n  };\r\n\r\n  const handleRemoveChat = (data) => {\r\n    setChatBoxList((prevState) => {\r\n      const chatDataList = prevState.filter((item) => item?.recipient !== data?.recipient);\r\n      return [...chatDataList];\r\n    });\r\n  };\r\n\r\n  return (\r\n    <ChatContainer>\r\n      {chatBoxList.map((item, index) => (\r\n        <ChatBox key={index} data={item} chatData={[]} onSendMessage={handleSendMessage} onChatRemove={handleRemoveChat} />\r\n      ))}\r\n      <ChatUsers users={users} onStartChat={handleStartChat} onClickUser={handleUserChatClick} />\r\n    </ChatContainer>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}